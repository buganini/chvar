<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style type="text/css">
.hl{
	border: solid 1px #f00;
}
.red{
	color:#f00;
}
td{
	border: solid 1px #777;
	text-align: center;
	width: 4em;
}
img,a{
	vertical-align:middle;
}
</style>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script type="text/javascript">
function doKeyDown(ev){
	if(navigator.userAgent.match("Gecko")){
		kc=ev.which;
	}else{
		kc=ev.keyCode;
	}
	if (ev.ctrlKey && kc == 13){
		dosubmit();
		return false;
	}
} 

function dosubmit(){
	var i=parseInt($('#level').val());
	if(i==1){
		addgrp1();
	}else if(i==2){
		addgrp2();
	}
}

function getinfo(){
	if(lc!=$('#text').val()){
		lc=$('#text').val();
		html=$.post('engine.php',{
			action: 'info',
			text: lc
		},function(t){$('#glyph').html(t);},"html");
	}
	showrelated1();
}

function showrelated1(){
	$.post('engine.php',{
		action: 'related1',
		text: lc
	},function(t){$('#related').html(t); nid=0;},"html");
	if(parseInt($('#level').val())>1){
		showgrp2can();
	}
}

function showgrp2can(){
	$.post('engine.php',{
		action: 'grp2can',
		text: lc
	},function(t){$('#grp2can').html(t); showrelated2();},"html");
}

function showrelated2(){
	s='';
	$('input:checkbox:checked[name=can2[]]').each(function(){s+=this.value+' ';});	
	$.post('engine.php',{
		action: 'related2',
		text: s
	},function(t){$('#related2').html(t); nid2=0;},"html");
}

function showinfo(s){
	$.post('engine.php',{
		action: 'info',
		text: s
	},function(t){$('#info').html(t);},"html");
}

function showinfo2(s){
	$.post('engine.php',{
		action: 'info2',
		text: s
	},function(t){$('#info2').html(t);},"html");
}

function addgrp1(){
	$.post('engine.php',{
		action: 'addgrp1',
		id: nid,
		text: $('#text').val(),
	},function(){showrelated1();},"json");
}
function addgrp2(){
	s='';
	$('input:checkbox:checked[name=can2[]]').each(function(){s+=this.value+' ';});
	$.post('engine.php',{
		action: 'addgrp2',
		id: nid2,
		text: s,
	},function(){showrelated2();},"json");
}
</script>
</head>
<body onkeydown="doKeyDown(event)">
<span style="width:50%; float:left;">
<select id="level">
<option value="1">Similar</option>
<option value="2">Borrow</option>
</select><br />
<textarea id="text" onKeyup="getinfo();"></textarea>
<input type="button" value="Submit" onClick="dosubmit()" />
<div id="glyph"></div>
</span><span style="float:left;" id="grp2can"></span>
<hr style="clear:both;" />
<span id="related" style="float:left; width:35%;"></span>
<div id="info" style="float:left; width:15%;"></div>
<span id="related2" style="float:left;"></span>
<div id="info2" style="clear:both; text-align:center;"></div>
<script type="text/javascript">
	lc='';
	nid=0;
	nid2=0;
</script>
</body>
</html>
